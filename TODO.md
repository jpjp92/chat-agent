# 📝 Project TODO List

## ✅ Recently Completed (2026-02-03)

### 별자리 시각화 엔진 (Astro-Viz) (2026-02-03) ✓
- ✅ **Phase 1: 2D 별자리 렌더링 (Canvas)**: 천구좌표(RA/Dec) 투영 엔진 및 12개 황도 별자리(Zodiac) 데이터셋 구축.
- ✅ **Phase 2: 인터랙션 시스템**: 줌/팬(Zoom/Pan) 제어, 시간 여행(Time Travel), 반응형 라벨링(Zoom-based Labels) 구현.
- ✅ **Phase 3: 은하수 렌더링 (Milky Way)**: 파티클 클라우드(Particle Cloud) 기반의 은하수 배경 렌더링 및 심미적 튜닝.
- ✅ **UI/UX 폴리시**: 커서 호버 효과, 버튼 피드백, 줌 인디케이터 등 사용자 경험 개선.
- 
- ### 의약품 시각화 엔진 (Drug-Viz) v3.1 (2026-02-07) ✓
- - ✅ **Smart Reveal (지능형 노출)**: 이미지 로딩을 최대 600ms 대기하여 텍스트와 이미지가 한 번에 우아하게 나타나는 동기화 입차 로직 구현.
- - ✅ **이미지 동기화 UI (Syncing UX)**: 인디고 틴트, 글로우(Glow) 효과, 프로그레스 바가 포함된 프리미엄 로딩 스켈레톤 적용.
- - ✅ **UI/UX 전면 개편**: 히어로 섹션, 성분/용법 통합 박스, 배지형 식별 정보 등 프리미엄 카드 UI 고도화.

### 사이드바 및 UI 고도화 (2026-02-08) ✓
- ✅ **사이드바 접기(Collapse) 구현**: 데스크탑 환경에서 사이드바를 미니멀하게 접어 공간을 확보하는 기능 추가 (Gemini Style).
- ✅ **반응형 동작**: 접힌 상태에서는 아이콘 중심의 네비게이션 제공 및 호버 시 툴팁/배경 효과 적용.
- ✅ **새 채팅 버튼 리디자인**: 기존 'Plus' 버튼에서 모던한 'Pen' 아이콘 및 회색 필(Pill) 스타일로 변경하여 Gemini UI와 톤앤매너 통일.
- ✅ **상태 동기화**: `App.tsx`에서 접힘 상태를 전역 관리하여 모바일/데스크탑 간 자연스러운 전환 지원.
- - ✅ **무료 아이콘 체계 (Icon Overhaul)**: 유료 아이콘 문제를 해결하기 위해 **100% Free FontAwesome 6** 아이콘 매핑으로 전면 교체.
- - ✅ **인코딩 안정화**: 숫자 범위(`~`) 변환 로직이 시각화 JSON 블록을 침범하지 않도록 텍스트 파트 한정한 정밀 처리.
- - ✅ **다국어 확장 (KO/EN/ES/FR)**: 4개 국어에 대한 시각화 레이블 및 UI 텍스트 완벽 대응.
- - ✅ **이미지 동기화 엔진**: Referer 우회를 위한 Supabase Storage 자동 캐싱 시스템 `/api/sync-drug-image` 최적화.
- 
- ### 인프라 및 설정 최적화 (2026-02-05) ✓
- - ✅ **Vite 설정 개선**: `host: 0.0.0.0` 설정으로 모바일 기기 테스트 환경 구축 및 불필요한 주석 정리.
- - ✅ **API 프록시**: 배포 환경(`chat-gem.vercel.app`)과의 통신을 위한 로컬 서버 프록시 설정 최적화.

### API & UI Resilience Improvements (2026-01-31) ✓
- ✅ **API Fallback Strategy**: `gemini-2.5-flash` 모델 쿼터 초과 시 `gemini-2.5-flash-lite`로 자동 전환되는 다중 모델 폴백 로직 구현.
- ✅ **출력 위생 처리 (Sanitization)**: Google Search Grounding 오작동으로 인한 무한 공백 생성(Hallucination) 방지 필터 구현.
- ✅ **표(Table) UI 고도화**: 긴 표에 대한 세로 스크롤(`max-h-500px`) 및 `<br>` 태그 자동 줄바꿈 처리로 가독성 개선.
- ✅ **프롬프트 최적화**: 표 헤더 간소화 및 응답 완결성 지침 추가로 답변 품질 및 안정성 강화.

### UI/UX & AI 응답 고도화 (2026-02-01) ✓
- ✅ **프리미엄 코드 블록 구현**: `react-syntax-highlighter` 연동으로 에디터급 문법 강조(Syntax Highlighting) 지원 및 미니멀한 헤더(언어 표시, 복사 버튼) 적용.
- ✅ **코드 생성 표준(Standards) 수립**: 시스템 프롬프트에 현대적 문법(ES6+, Type Hints), 클린 구조, 주석 최적화 지침을 추가하여 AI 응답 질 개선.
- ✅ **BioRenderer 수직 정렬 최적화**: CSS 패딩 기반 레이아웃(`pt-10 pb-16`)으로 단백질 구조가 상하 배지 사이의 시각적 중앙에 정확히 배치되도록 개선.
- ✅ **시퀀스 뷰 모바일 최적화**: 모바일 중앙 정렬(`justify-center`)과 수직 밸런스(`min-h-[300px]`) 확보로 터치 환경 가독성 향상.

### BioRenderer 3D 구조 시각화 UI/UX 개선 (2026-02-01) ✓
- ✅ **수직 정렬 최적화**: CSS 패딩 기반 레이아웃(`pt-32 pb-24`)으로 단백질 구조가 상하 배지 사이의 시각적 중앙에 정확히 배치되도록 개선.
- ✅ **초기 로딩 정렬 안정화**: 지연 실행(600ms, 1200ms) 이중 `autoView` 호출로 레이아웃 확정 후 정렬하여 초기 점프 현상 제거.
- ✅ **모바일 툴팁 UX**: 모바일 환경에서 잔기 정보 툴팁을 하단 고정 패널로 전환하여 터치 인터랙션 시 가독성 대폭 향상.
- ✅ **반응형 레이아웃**: 모바일(`min-h-[300px]`)과 데스크탑(`min-h-[350px]`) 각각 최적화된 최소 높이 적용.
- ✅ **카메라 조작 제거**: 복잡한 수동 `translate`/`zoom` 로직 제거하고 NGL 기본 `autoView`와 CSS만으로 안정적 정렬 구현.

### 물리학 시뮬레이션 엔진 도입 (Phy-Viz) (2026-02-01) ✓
- ✅ **Matter.js 기반 2D 물리 엔진**: 고전 역학, 충돌 시뮬레이션 지원을 위한 `PhysicsRenderer` 구현.
- ✅ **교육용 다이어그램(Illustrated Explainer) 모드**: 물체별 **텍스트 라벨** 및 **벡터 화살표(힘, 속도)** 실시간 렌더링 기능 추가.
- ✅ **시각적 정교화**: 화살표를 물체 테두리(Side)로 오프셋하여 시인성 확보 및 교육용 **슬로우 모션 중력** 가이드 도입.
- ✅ **테스트 가이드 구축**: 고전역학 시나리오별 테스트용 프롬프트를 정리한 `physcripts.md` 생성.
- ✅ **연결 고리(Constraints/Joints) 지원**: 물체 간 연결 시스템 구축 (안정성을 위해 현재는 프롬프트에서 선택적 활용).
- ✅ **반응형 캔버스 아키텍처**: 웹(16:9) 및 모바일(4:3) 최적화 비율 자동 전환 로직 탑재.
- ✅ **가상 좌표계(Virtual Scale) 최적화**: 모든 디바이스에서 동일한 물리 체감 제공.
- ✅ **프리미엄 UI/UX**: 투명 경계면, 하단 여백, 오버레이 헤더 디자인 적용.


### 시각화 모듈 다국어화 (Deep Localization) ✓
- ✅ **전역 다국어 연동**: Bio, Chemical, Chart 렌더러가 전역 언어 설정(KO, EN, ES, FR)에 맞춰 내부 라벨('Chain', 'Atomic', 'Structure' 등)을 자동 전환.
- ✅ **AI 응답 강제 고정**: 사용자가 다른 언어로 질문하더라도 설정된 언어로만 답변하도록 시스템 지침(System Instruction) 최적화 및 Gemini API 호출 구조 고도화.
- ✅ **로딩 상태 로컬라이제이션**: '분석 중...' 등 시각화 장치 로딩 문구를 다국어 대응.

### 멀티모달 영상 분석 (Video-to-Text) 도입 (2026-02-02) ✓
- ✅ **직접 영상 분석**: MP4, MOV 등 영상 파일을 Gemini 2.5 Flash로 직접 분석하는 기능 구현.
- ✅ **Video-to-Text 전환**: 최초 분석 시 영상 내용을 상세 텍스트로 추출하여 세션 컨텍스트(`lastActiveDoc`)로 자동 저장.
- ✅ **대용량 처리 최적화**: Supabase Storage(`chat-videos`) 연동 및 Vercel API 크기 제한(30MB) 상향 조정.
- ✅ **UI/UX 개선**: 영상 파일 전용 프리뷰 아이콘, 크기 제한(20MB) 안내 및 단계별 로딩 상태(분석 중, 시청 중) 구현.

### 코드 렌더링 및 마크다운 고도화 (2026-02-02) ✓
- ✅ **코드 블록 무결성(Integrity)**: 긴 코드가 여러 블록으로 쪼개지거나 박스 밖으로 튀어나오는 현상을 방지하기 위해 단일 블록 생성(Single-block generation) 및 강제 개행 지침 수립.
- ✅ **프리미엄 타이포그래피**: `H3`, `Strong`, `EM`, `Blockquote`, `KBD` 등 마크다운 태그별 전용 스타일 설계로 AI 응답 가독성 극대화.
- ✅ **인라인 코드 스타일 개선**: 대비와 가시성을 높인 전용 컬러팩 및 모서리 곡률(`rounded-md`) 조정.
- ✅ **인라인 언어 태그 방지**: 인라인 백틱 내부에 `python:` 등의 불필요한 언어 접두사가 포함되지 않도록 시스템 프롬프트 정교화.

### App.tsx 컴포넌트 분리 (Refactoring) ✓
- ✅ **LoadingScreen 컴포넌트화**: `isAuthLoading` 상태일 때 보여주는 로딩 UI를 독립 컴포넌트(`LoadingScreen.tsx`)로 분리.
- ✅ **WelcomeMessage 컴포넌트화**: 채팅 시작 전 웰컴 메시지 UI를 독립 컴포넌트(`WelcomeMessage.tsx`)로 분리하여 다국어 지원 강화.
- ✅ **ChatArea 컴포넌트화**: 실제 메시지가 렌더링되는 메인 영역을 독립 컴포넌트(`ChatArea.tsx`)로 분리하여 `App.tsx`의 복잡도 감소 및 유지보수성 향상.

### API 보안 및 관리 효율화 (2026-01-31) ✓
- ✅ **동적 API Key 로드**: `API_KEY*` 패턴의 모든 환경 변수를 자동으로 감지하고 로테이션하는 중앙 설정(`api/lib/config.ts`) 구현.
- ✅ **프론트엔드 보안 강화**: `vite.config.ts`에서 클라이언트로의 API Key 주입 제거 및 백엔드 전용 관리 체계 확립.
- ✅ **중복 코드 제거**: 여러 API 엔드포인트(`chat`, `speech`, `title`)에서 개별적으로 관리하던 키 로직을 하나로 통합.

### Bio-Viz 및 시각화 로직 안정화 ✓
- ✅ **WebGL 자원 관리**: NGL Stage 소멸 시 `.dispose()` 명시적 호출로 메모리 누수 방지 및 WebGL 컨텍스트 최적화.
- ✅ **PDB 뷰어 UI 정제**: 헤더의 불필요한 중복 라벨을 제거하고 툴팁 좌표 계산 방식을 개선하여 클리핑 현상 해결.
- ✅ **스냅샷 기능 개선**: 투명 배경 대신 화이트 배경 처리를 보강하여 외부 리포트 호환성 증대.

## ✅ Recently Completed (2026-01-30)

### 화학 및 생물 구조 시각화 고도화 ✓
- ✅ **화학 구조 모바일 뷰 최적화**: 긴 선형 분자가 모바일에서 너무 작게 보이는 문제를 해결하기 위해 최소 너비(`min-w`) 설정 및 가로 스크롤 지원.
- ✅ **버튼 레이블 단순화**: 모바일 가독성을 위해 'SMILES NOTATION' -> 'SMILES', 'COPY SMILES' -> 'COPY'로 텍스트 간소화.
- ✅ **몰입형 3D 레이아웃 (Bio-Viz)**: 테두리를 제거하고 플로팅 배지와 투명 헤더를 적용하여 현대적인 3D 뷰어 경험 제공.
- ✅ **프리미엄 커스텀 툴팁 (Bio-Viz)**: NGL 기본 툴팁 대신 글래스모피즘 디자인의 상호작용형 툴팁 구현.
- ✅ **데스크탑 렌더링 안정화**: `ResizeObserver`를 통한 화면 미출력 버그 해결.
- ✅ **호버 감지 및 잔기 정보 노출 정밀화**: `PickingProxy`와 `fixed` 포지셔닝 툴팁을 결합하여 가닥 위의 잔기 번호(#)를 실시간으로 정확히 추적.
- ✅ **거대 구조물 시각화 검증**: 코넥신(Connexin, 2ZW3) 등 12개 이상의 체인을 가진 거대 채널 단백질에 대한 안정적인 렌더링 및 분석 확인.

### 데이터 시각화 및 문서 렌더링 ✓
- ✅ **README 최신화**: Mermaid 아키텍처 다이어그램 및 신규 컴포넌트 구조 반영.
- ✅ **LaTeX 렌더링 최적화**: KaTeX CSS 연동, 모바일 가로 스크롤 지원, 인라인/블록 수식 스타일링 차별화.

### 한글 HWPX 문서 분석 지원 ✓
- ✅ `JSZip` 라이브러리를 활용하여 `.hwpx` 파일(ZIP 패키지) 압축 해제
- ✅ `Contents/section*.xml` 파일에서 `<hp:t>` 태그 내 텍스트 추출
- ✅ HTML 엔티티 디코딩 및 Gemini API 컨텍스트 전달
- ✅ 드래그 앤 드롭 및 파일 선택 UI 지원

### Markdown 렌더링 개선 ✓
- ✅ 숫자 범위 표기(`1~10`) 시 취소선 오류 수정
- ✅ 정규식으로 `~` 기호를 HTML 엔티티(`&#126;`)로 치환하여 해결

### 문서화 개선 ✓
- ✅ README에 Mermaid 시스템 아키텍처 다이어그램 추가
- ✅ 프로젝트 구조 문서 업데이트 (JSZip 반영)
- ✅ 기능 설명에 HWPX 지원 명시

### 파워포인트(PPTX) 문서 분석 지원 ✓
- ✅ `JSZip`을 활용한 직접 XML 파싱 (`ppt/slides/slide*.xml`)
- ✅ `<a:t>` 태그에서 텍스트 추출 및 슬라이드별 구조화
- ✅ 텍스트 없는 PPTX 파일에 대한 예외 처리 (슬라이드 개수 + 안내 메시지)
- ✅ 드래그 앤 드롭 및 파일 선택 UI 지원 (주황색 PowerPoint 아이콘)

---

## 🚀 Priority Tasks (Future Roadmap)

### 1. 세션 내 문서 컨텍스트 영구 저장 (Persistence)
- [ ] **목표**: 현재 브라우저 메모리(React State)에만 저장되는 `lastActiveDoc` 정보를 새로고침 후에도 유지.
- [ ] **방법**:
    - Supabase `chat_sessions` 테이블에 `last_active_doc` (JSONB 타입) 컬럼 추가.
    - 문서 업로드 또는 세션 전환 시 해당 컬럼을 DB에 업데이트 및 동기화.
    - 세션 로드 시 DB에서 추출된 텍스트 컨텍스트를 불러와 AI에게 즉시 제공.

### 2. 다중 이미지 분석 및 문서 분석 고도화 (Intelligence)
- [ ] **다중 이미지 분석 (Multi-image Analysis)**:
    - 한 번의 요청에 **최대 3장**의 이미지를 동시 분석 가능하도록 확장.
    - `ChatInput`에 선택된 이미지 미리보기 갤러리 및 이미지 개수 제한 가드 로직 구현.
    - 병렬 업로드 및 Gemini 멀티모달 프롬프트 구조 최적화.
- [ ] **CSV/XLSX 파싱 고도화**: 대용량 데이터 처리 (상위 N행 제한 및 요약 안내).
- [ ] **다중 문서 업로드**: 여러 개의 문서 파일을 동시에 업로드하고 교차 분석 지원.

### 3. 화학 구조 시각화 반응형 고도화 (Chemical-Viz)
- [ ] **뷰박스(ViewBox) 기반 반응형 구현**: 고정 너비를 제거하고 `viewBox`를 적용하여 데스크탑에서는 시원하게, 모바일에서는 딱 맞게 자동 스케일링.
- [ ] **동적 본드 길이(Bond Length) 조절**: SMILES 문자열 길이에 따라 결합선 길이를 반비례 조절하여 긴 분자의 디테일 보존.
- [ ] **가로 스크롤 레이아웃 보강**: 초거대 분자 대응을 위한 터치 기반 가로 탐색 UI 강화.

### 4. 별자리 시각화 엔진 고도화 (Astro-Viz Advanced)
- [ ] **Phase 4: 3D 천구 및 고급 기능 (Expert)**
    - [ ] Three.js 기반 3D 천구 전환 (회전/확대 가능).
    - [ ] 행성 위치 계산 (케플러 궤도 방정식).
    - [ ] 실시간 ISS 위치 오버레이.
    - [ ] 별 클릭 시 위키/상세 정보 툴팁 표시.


### 5. 수식 기반 그래프 및 벡터장 (Plotly/D3)
    - LaTeX 수식 입력 -> JS 수치 해석 -> 동적 그래프 시각화.
    - 전자기장 벡터 필드, 파동 함수, 3D 표면 차트(Surface Plot) 구현.
- [ ] **Phase 3: 3D 강체/유체 시뮬레이션 (Three.js + Rapier)**
    - React Three Fiber(R3F) 기반의 고성능 3D 물리 엔진 탑재.
    - **유체 역학(Fluid Dynamics)**: 입자 시스템(SPH)을 활용한 물/액체 시뮬레이션.
    - 복잡한 3D 구조물 및 강체 상호작용 실험.
- [ ] **Phase 4: 정밀 식별 데이터 스크래핑 (Drug-Viz Advanced)**
    - [ ] `sync-drug-image.ts` 크롤링 범위를 HTML 테이블(`tbody.identify`)로 확장.
    - [ ] AI 요약 대신 제조사 등록 원본 데이터(장축/단축, 각인 등)를 100% 정밀도로 수집 및 UI 연동.

---

## 🛠️ Minor Improvements

- [x] 지원하지 않는 파일 형식 업로드 시 사용자 친화적인 안내 강화 (Toast 메시지).
- [x] 코드 블록 및 시각화 결과물 내보내기 버튼 추가.
- [ ] 메시지 재생성 기능 추가.
- [ ] 다크모드/라이트모드 UI 일관성 폴리싱 (Borderless 전략 상시 적용).

---

## 🧹 Code Quality & Refactoring

- [ ] **API Key 관리 및 보안 강화**
    - [x] `vite.config.ts`에서 하드코딩된 `API_KEY` 주입 제거 (프론트엔드 노출 방지).
  - [x] 백엔드(`api/*.ts`)에서 `process.env`를 이용한 동적 API Key 로드 및 로테이션 구현.
  - [x] Vercel 환경 변수 추가 시 코드 수정 없이 자동 반영되도록 개선.
- [ ] 불필요한 파일 정리 (`test-supabase.ts`, `metadata.json`).
- [ ] `reference/` 폴더 삭제 고려 (HWPX 구현 완료).
- [ ] ESLint/Prettier 설정 추가.
- [ ] 단위 테스트 작성 (Vitest).

---

*Last Updated: 2026-02-07 (v3.1)*
